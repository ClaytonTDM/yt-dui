<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>yt-dui</title>
        <style>
            :root {
                color-scheme: dark;
                --1: #202020;
                --2: #333;
                --3: #444;
                --4: #555;
                --5: #777;
                --6: #aaa;
                --accent: #bd90f4;
                --accent2: #75529f;
            }
            h1,
            h2,
            h3,
            h4,
            h5,
            h6,
            p,
            a,
            label,
            input,
            select,
            textarea {
                user-select: none;
            }
            .hidden {
                display: none;
            }
            body {
                font-family: system-ui, -apple-system, BlinkMacSystemFont,
                    "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Open Sans",
                    "Helvetica Neue", sans-serif;
                background-color: var(--1);
                color: #fff;
                margin-left: 30px;
                user-select: none;
            }
            textarea {
                font-family: system-ui, -apple-system, BlinkMacSystemFont,
                    "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Open Sans",
                    "Helvetica Neue", sans-serif;
                background-color: var(--1);
                width: calc(100% - 53px);
                color: #fff;
                border: solid 2px var(--3);
                padding: 10px;
                margin-top: 5px;
                margin-bottom: 1px;
                border-radius: 5px;
                resize: none;
            }
            textarea:focus {
                outline: none;
                margin-bottom: 0;
                border-bottom: 3px solid var(--accent);
            }
            label {
                font-size: 1em;
            }
            .br {
                margin-bottom: 15px;
            }
            .brhalf {
                margin-bottom: 7.5px;
            }
            .br-75 {
                margin-bottom: 11.25px;
            }
            .right {
                float: right;
                margin-left: 6px;
            }
            .farright {
                float: right;
                margin-right: 30px;
                margin-left: 6px;
            }
            select {
                padding-right: 63px;
                padding-top: 3.5px;
                padding-bottom: 3.5px;
                border-radius: 5px;
                background-color: var(--2);
                border: 2px solid var(--3);
            }
            select:focus {
                outline: none;
            }
            .formatright {
                margin: 0 30px 0 0;
            }
            input[type="radio"] {
                display: none;
            }
            input[type="radio"] + label:before {
                content: "";
                display: inline-block;
                width: 12.5px;
                height: 12.5px;
                margin: 0 5px 0 5px;
                border-radius: 50%;
                border: 2px solid var(--5);
                box-sizing: border-box;
                background-color: var(--3);
            }
            input[type="radio"]:checked + label:before {
                background-color: var(--2);
                border: 4px solid var(--accent);
            }
            input[type="radio"].firstradio + label:before {
                margin-left: 0;
                margin-top: 6px;
            }
            .file-upload {
                display: flex;
                align-items: center;
            }
            #file-name {
                flex-grow: 1;
                margin-right: 5px;
                margin-bottom: 1px;
                padding-top: 6.5px;
                padding-bottom: 6.5px;
                border-radius: 5px;
                background-color: var(--1);
                border: 2px solid var(--3);
                border-bottom: 2px solid var(--4);
            }
            #file-name:focus {
                outline: none;
                margin-bottom: 0;
                border-bottom: 3px solid var(--accent2);
            }

            button {
                text-align: center;
                padding: 6.5px 40px 6.5px 40px;
                border-radius: 5px;
                margin-right: 30px;
                background-color: var(--2);
                border: 2px solid var(--3);
            }
            button:hover {
                background-color: var(--3);
            }
            #download-button {
                width: calc(100% - 30px);
            }
            #log {
                border-radius: 0;
                font-family: "Courier New", Courier, monospace;
                color: #ccc;
                overflow: hidden;
            }
            #version {
                color: var(--6);
            }
        </style>
    </head>
    <body>
        <h1>Let's download stuff.</h1>
        <label for="urls">Source URLs</label>
        <textarea
            id="urls"
            placeholder="https://www.youtube.com/watch?v=dQw4w9WgXcQ"
            rows="4"
            spellcheck="false"
        ></textarea>

        <div class="br"></div>
        <label for="type" class="">Download type</label>
        <label for="format" class="right formatright" id="formarlabel"
            >Video format</label
        >
        <label for="resolution" class="farright" id="resolutionlabel"
            >Video resolution</label
        >

        <div class="brhalf"></div>

        <input
            class="firstradio"
            type="radio"
            id="video"
            name="type"
            value="video"
            checked="true"
        />
        <label for="video">Video</label>
        <input type="radio" id="audio" name="type" value="audio" class />
        <label for="audio">Audio only</label>

        <select class="farright" name="format" id="videoformat">
            <option value="mp4">MP4</option>
            <option value="mkv">MKV</option>
            <option value="mov">MOV</option>
            <option value="avi">AVI</option>
            <option value="flv">FLV</option>
        </select>
        <select class="hidden farright" name="format" id="audioformat">
            <option value="mp3">MP3</option>
            <option value="wav">WAV</option>
            <option value="flac">FLAC</option>
            <option value="aac">AAC</option>
            <option value="alac">ALAC</option>
            <option value="m4a">M4A</option>
            <option value="opus">OPUS</option>
            <option value="vorbis">VORBIS</option>
        </select>

        <select class="right" name="resolution" id="resolution">
            <option value="1080p">1080p</option>
            <option value="720p">720p</option>
            <option value="480p">480p</option>
            <option value="360p">360p</option>
            <option value="240p">240p</option>
            <option value="144p">144p</option>
        </select>
        <br /><br />
        <label for="outputdir">Output directory</label>
        <div class="br-75"></div>
        <div class="file-upload">
            <input type="text" id="file-name" readonly />
            <button type="button" id="file-button">Browse...</button>
            <input
                type="file"
                webkitdirectory
                directory
                id="file-upload"
                style="display: none"
            />
        </div>
        <div class="br"></div>
        <button id="download-button">Start download</button>
        <div class="halfbr"></div>
        <textarea disabled id="log" spellcheck="false" rows="3">
logs here blabla</textarea
        >
        <div class="br"></div>
        <label id="version">yt-dlp</label>
        <script>
            document.getElementById("urls").placeholder =
                "https://www.youtube.com/watch?v=dQw4w9WgXcQ\nhttps://www.youtube.com/watch?v=PUew7VIUfnA\netc...";
            const { dialog } = require("@electron/remote");

            document
                .getElementById("file-button")
                .addEventListener("click", function () {
                    dialog
                        .showOpenDialog({
                            properties: ["openDirectory"],
                        })
                        .then((result) => {
                            if (!result.canceled) {
                                document.getElementById("file-name").value =
                                    result.filePaths[0];
                            }
                        })
                        .catch((err) => {
                            console.log(err);
                        });
                });

            let audioClicked = false;
            document.getElementById("audio").addEventListener("click", () => {
                audioClicked = true;
                document.getElementById("videoformat").classList.add("hidden");
                document
                    .getElementById("audioformat")
                    .classList.remove("hidden");
                document.getElementById("resolution").classList.add("hidden");
                document
                    .getElementById("resolutionlabel")
                    .classList.add("hidden");
                document.getElementById("formarlabel").innerHTML =
                    "Audio format";
            });
            document.getElementById("video").addEventListener("click", () => {
                audioClicked = false;
                document
                    .getElementById("videoformat")
                    .classList.remove("hidden");
                document.getElementById("audioformat").classList.add("hidden");
                document
                    .getElementById("resolution")
                    .classList.remove("hidden");
                document
                    .getElementById("resolutionlabel")
                    .classList.remove("hidden");
                document.getElementById("formarlabel").innerHTML =
                    "Video format";
            });

            // using electron nodeintegration
            // get yt-dlp version by running ./binary/yt-dlp --version
            const { exec } = require("child_process");
            exec("./binary/yt-dlp --version", (error, stdout, stderr) => {
                if (error) {
                    console.error(`exec error: ${error}`);
                    return;
                }
                document.getElementById("version").innerHTML =
                    "yt-dlp " + stdout;
            });

            function log(log) {
                document.getElementById("log").value = log;
                document.getElementById("log").scrollTop =
                    document.getElementById("log").scrollHeight;
            }

            const path = require('path');
const YTDlpWrap = require('yt-dlp-wrap').default;

// Add the directory containing yt-dlp, ffmpeg, and ffprobe to the PATH
process.env.PATH += path.delimiter + path.join(__dirname, 'path/to/yt-dlp/binary');

const ytDlpWrap = new YTDlpWrap('yt-dlp');

document.getElementById("download-button").addEventListener("click", function () {
    // Get the values of the input fields
    const urls = document.getElementById("urls").value.split('\n');
    const type = document.querySelector('input[name="type"]:checked').value;
    const format = document.getElementById(type + 'format').value;
    const resolution = document.getElementById("resolution").value;
    const outputDir = document.getElementById("file-name").value;

    // Set the options for the download
    let options = [
        '-f',
        type === 'video' ? `bestvideo[height<=${resolution.replace('p', '')}]+bestaudio/best[ext=${format}]` : `bestaudio[ext=${format}]`,
        '-o',
        `${outputDir}/%(title)s.%(ext)s`
    ];

    // Download the video or audio for each URL
    urls.forEach(url => {
        let ytDlpEventEmitter = ytDlpWrap.exec([url, ...options])
            .on('progress', (progress) =>
                console.log(
                    progress.percent,
                    progress.totalSize,
                    progress.currentSpeed,
                    progress.eta
                )
            )
            .on('ytDlpEvent', (eventType, eventData) =>
                console.log(eventType, eventData)
            )
            .on('error', (error) => console.error(error))
            .on('close', () => console.log('all done'));

        console.log(ytDlpEventEmitter.ytDlpProcess.pid);
    });
});
        </script>
    </body>
</html>
